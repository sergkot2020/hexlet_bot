create table if not exists "user"
(
    id          serial  not null
        constraint telegram_user_pk
            primary key,
    telegram_id bigint  not null,
    is_bot      boolean not null,
    first_name  varchar,
    last_name   varchar,
    lang_code   varchar,
    phone       varchar,
    username    varchar,
    create_ts   timestamp with time zone default now()
);

create table if not exists chat
(
    id          serial                                 not null
        constraint chat_pk
            primary key,
    telegram_id bigint                                 not null,
    gigagroup   boolean                  default false not null,
    megagroup   boolean                  default true  not null,
    create_ts   timestamp with time zone default now()
);

create unique index if not exists chat_telegram_id_uindex
    on chat (telegram_id);

create unique index if not exists telegram_user_telegram_id_uindex
    on "user" (telegram_id);

create table if not exists chat_user_relation
(
    chat_id bigint
        constraint chat_user_relation_chat_id_fk
            references chat,
    user_id bigint
        constraint chat_user_relation_telegram_user_telegram_id_fk
            references "user"
);

create index if not exists chat_user_relation_chat_id_index
    on chat_user_relation (chat_id);

create index if not exists chat_user_relation_chat_id_user_id_index
    on chat_user_relation (chat_id, user_id);

create index if not exists chat_user_relation_user_id_index
    on chat_user_relation (user_id);


